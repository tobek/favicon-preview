rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /shortlinks/{shortId} {
      // Anyone can read
      allow read: if true;

      // Anyone can create, with validation
      allow create: if request.resource.data.keys().hasAll(['id', 'favicons', 'color', 'version', 'createdAt'])
                    && request.resource.data.favicons is list
                    && request.resource.data.favicons.size() > 0
                    && request.resource.data.favicons.size() <= 50  // Max 50 favicons
                    && request.resource.data.color is string
                    && request.resource.data.color.size() == 6      // Hex color
                    && request.resource.data.version is int
                    && request.resource.data.createdAt is number;

      // No updates or deletes from clients
      allow update, delete: if false;
    }
  }
}
